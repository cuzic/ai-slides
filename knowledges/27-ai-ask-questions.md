# AIに質問させる手法 - あいまいさを事前に解消する

**対象**: 要件定義・設計フェーズでAI駆動開発を行う開発者
**目的**: AIに「わからないことは質問させる」ことで、あいまいさを事前に解消し、手戻りを削減する
**AI問題との関連**: 暴走（Scope Creep）、手抜き（Reward Hacking）、忘れっぽさ（Context Limitations）の3つすべてに効果あり

---

## なぜAIに質問させるのか

AIは「わからないことがあっても質問せずに、勝手に推測して実装する」特性がある。
これが3つのAI問題を引き起こす：
- **暴走**：「データベースは？」→明示されていないので勝手にPostgreSQLを追加
- **手抜き**：「どうテストする？」→明示されていないのでハードコードで済ませる
- **忘れっぽさ**：「さっき何を決めた？」→Compact後に忘れるが、質問せずに推測で進める

対策：「実装前に、あいまいな点があれば必ず質問してください」と明示的に指示する。

---

## Claude Codeへの指示例

### 基本形

```
要件定義を開始します。
以下の内容について、あいまいな点、不明な点、決定が必要な点があれば、
実装前に必ず質問してください。

【要件】
TODO管理アプリを作りたい。
```

### AIの質問例

```markdown
以下の点について確認させてください：

## データ永続化
1. データベースは何を使いますか？（H2/PostgreSQL/MySQL/MongoDB等）
2. ファイルベースですか、サーバーベースですか？
3. 認証は必要ですか？

## 機能範囲
4. TODO作成・一覧表示・更新・削除のCRUD全てが必要ですか？
5. 優先度やステータスの管理は必要ですか？
6. 期限の設定は必要ですか？

## UI
7. Webアプリですか、CLIですか、APIのみですか？
8. フロントエンド技術は何を使いますか？（React/Vue/Thymeleaf等）

## テスト
9. 単体テストは必要ですか？カバレッジの目標は？
10. E2Eテストは必要ですか？

これらを明確にすることで、正確な実装が可能になります。
```

---

## 設計フェーズでの質問例

### DBスキーマ設計時

```
以下のDBスキーマ設計について、あいまいな点があれば質問してください。

CREATE TABLE todos (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  status VARCHAR(20),
  priority VARCHAR(10),
  due_date DATE,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

**AIの質問例**:
```markdown
以下の点について確認させてください：

1. statusの取りうる値は何ですか？（例：TODO/IN_PROGRESS/DONE）
2. priorityの取りうる値は何ですか？（例：HIGH/MEDIUM/LOW）
3. statusとpriorityはENUM型にしますか、VARCHAR型にしますか？
4. due_dateはNULL許容ですか？（期限なしのTODOを許可するか）
5. created_atとupdated_atのデフォルト値は現在時刻ですか？
6. 論理削除（deleted_atカラム追加）は必要ですか？
```

### API設計時

```
TODO作成APIを設計します。あいまいな点があれば質問してください。

POST /api/todos
```

**AIの質問例**:
```markdown
以下の点について確認させてください：

1. リクエストボディのフォーマットは？（JSON/Form URL Encoded）
2. 必須パラメータは何ですか？（titleのみ？他も？）
3. バリデーションルールは？（title長さ、descriptionの最大長等）
4. レスポンスは作成されたTodoオブジェクトを返しますか？
5. HTTPステータスコードは201 Createdですか、200 OKですか？
6. エラー時のレスポンスフォーマットは？
7. 認証・認可は必要ですか？
```

---

## 複数案を提案させる手法

AIに「複数の選択肢を提案して、それぞれのメリット・デメリットを説明して」と指示することで、より良い意思決定ができる。

### Claude Codeへの指示例

```
TODO管理アプリのフロントエンド技術について、3つの選択肢を提案してください。
それぞれのメリット・デメリット、学習コスト、保守性を比較して、
プロジェクトの制約（Java/Spring Boot経験者、AI駆動開発初心者、開発期間1週間）を
考慮した推奨案を示してください。
```

### AIの提案例

```markdown
## フロントエンド技術の選択肢

### 案1: Thymeleaf + バニラJavaScript
**メリット**:
- Spring Bootとの統合が容易（テンプレートエンジン標準装備）
- 学習コストが低い（HTMLとJSの基本知識で開発可能）
- サーバーサイドレンダリングでSEO対策不要

**デメリット**:
- リッチなUIは作りにくい
- 大規模アプリには不向き

**学習コスト**: ★☆☆☆☆（1週間で習得可能）
**保守性**: ★★★☆☆（中規模まで）

### 案2: React + REST API
**メリット**:
- モダンなUI/UX実現可能
- コンポーネント再利用性が高い
- 大規模アプリにも対応可能

**デメリット**:
- 学習コストが高い（React、Webpack、npm等）
- バックエンドとの分離で開発工数増加
- Java経験者には不慣れな技術

**学習コスト**: ★★★★☆（1-2ヶ月必要）
**保守性**: ★★★★★（大規模対応）

### 案3: Thymeleaf + Alpine.js
**メリット**:
- Thymeleafのシンプルさとモダンなリアクティブ性を両立
- Alpine.jsは軽量（Vue.jsライクな記法、学習コスト低）
- Spring Bootとの統合容易

**デメリット**:
- Alpine.jsは比較的新しい技術（情報が少ない）
- 大規模アプリには不向き

**学習コスト**: ★★☆☆☆（1週間で習得可能）
**保守性**: ★★★★☆（中規模まで）

## 推奨案

**プロジェクト制約を考慮した推奨**: **案1: Thymeleaf + バニラJavaScript**

**理由**:
1. Java/Spring Boot経験者が多い → Thymeleafは標準で学習コスト最小
2. AI駆動開発初心者 → シンプルな技術の方がAI指示も簡単
3. 開発期間1週間 → 学習時間を最小化し、実装に集中
4. TODO管理アプリ → 規模が小さくThymeleafで十分

**次善の策**: 開発者にReact経験者がいる場合は案2、モダンなUIが必須なら案3を検討。
```

---

## ペルソナごとのMoSCoW分析

複数のペルソナを設定し、ペルソナごとにユーザーストーリーのMoSCoW分析を行うことで、優先順位を明確化できる。

### Claude Codeへの指示例

```
TODO管理アプリの要件定義を行います。
以下の3つのペルソナを設定し、それぞれのペルソナにとってのユーザーストーリーを作成してください。
各ユーザーストーリーにMoSCoW分析（Must/Should/Could/Won't）を適用してください。

【ペルソナ1】忙しいビジネスパーソン（田中さん、35歳、営業職）
- 1日に50件以上のタスクを管理
- 移動中にスマホでTODO確認
- 優先度による絞り込みが重要

【ペルソナ2】フリーランスエンジニア（佐藤さん、28歳）
- プロジェクト単位でタスク管理
- 期限管理が重要
- コマンドライン操作が好き

【ペルソナ3】主婦（鈴木さん、42歳）
- 家事・買い物・子供の予定を管理
- シンプルなUIが重要
- リマインダー機能が欲しい
```

### AIの提案例

```markdown
## ペルソナ1: 忙しいビジネスパーソン（田中さん）

### ユーザーストーリー1: 優先度フィルター
「忙しいビジネスパーソンとして、TODOを優先度でフィルタリングしたい、なぜなら重要なタスクに集中したいから」
- **MoSCoW**: Must

### ユーザーストーリー2: スマホ対応
「忙しいビジネスパーソンとして、スマホでTODOを確認したい、なぜなら移動中にも確認したいから」
- **MoSCoW**: Should（MVP後に対応）

### ユーザーストーリー3: 一括削除
「忙しいビジネスパーソンとして、完了済みTODOを一括削除したい、なぜなら1日50件も処理するから」
- **MoSCoW**: Could

## ペルソナ2: フリーランスエンジニア（佐藤さん）

### ユーザーストーリー1: 期限管理
「フリーランスエンジニアとして、TODOに期限を設定したい、なぜなら納期を守りたいから」
- **MoSCoW**: Must

### ユーザーストーリー2: CLI対応
「フリーランスエンジニアとして、CLIでTODO操作したい、なぜならターミナル作業が多いから」
- **MoSCoW**: Won't（今回は対応しない、Web UIのみ）

## ペルソナ3: 主婦（鈴木さん）

### ユーザーストーリー1: シンプルなUI
「主婦として、シンプルで直感的なUIでTODO管理したい、なぜなら複雑な操作は苦手だから」
- **MoSCoW**: Must

### ユーザーストーリー2: リマインダー
「主婦として、期限前にリマインダーが欲しい、なぜなら子供の予定を忘れたくないから」
- **MoSCoW**: Should（MVP後に対応）

## 全ペルソナ共通のMust要件

上記から、全ペルソナに共通する「Must」要件を抽出：
1. TODO作成・一覧表示・更新・削除（CRUD基本）
2. 優先度設定（HIGH/MEDIUM/LOW）
3. ステータス管理（TODO/IN_PROGRESS/DONE）
4. シンプルで直感的なUI

**MVP（Minimum Viable Product）スコープ**: 上記4つのみに絞る
**Phase 2（MVP後）**: スマホ対応、リマインダー
**Phase 3（将来）**: 一括削除、タグ管理等
```

---

## AIに質問させることで防げるAI問題

### 暴走（Scope Creep）を防ぐ

**問題**: AIが「データベースは？」と聞かずに、勝手にPostgreSQL、Redis、MongoDBを追加
**対策**: 「技術スタックについて不明な点があれば質問してください」と指示
**結果**: AIが「データベースは何を使いますか？」と質問 → H2と明示 → 暴走防止

### 手抜き（Reward Hacking）を防ぐ

**問題**: AIが「どうテストする？」と聞かずに、ハードコード実装でテストをパス
**対策**: 「テスト方法について不明な点があれば質問してください」と指示
**結果**: AIが「JUnit 5で単体テスト必要ですか？」と質問 → 必要と明示 → 手抜き防止

### 忘れっぽさ（Context Limitations）を防ぐ

**問題**: Compact後に「優先度はenum型」という決定を忘れ、String型で実装
**対策**: 「設計書に記載されていない点があれば質問してください」と指示
**結果**: AIが「優先度の型はenum型ですか？」と質問 → schema.sqlに明記 → 忘れっぽさ防止

---

## CLAUDE.mdへの記載例

```markdown
# プロジェクトルール

## AI指示の基本原則

### 実装前に必ず質問すること
実装前に、以下の点について不明・あいまいな点があれば、必ず質問してください：
1. 技術スタック（使用するライブラリ、フレームワーク）
2. データベーススキーマ（型、制約、デフォルト値）
3. API仕様（エンドポイント、パラメータ、レスポンス）
4. テスト方法（単体テスト、E2Eテスト、カバレッジ）
5. 受入条件（GIVEN WHEN THEN）

### 複数案を提案すること
重要な技術選定や設計判断では、複数の選択肢を提案し、
それぞれのメリット・デメリットを説明してください。
```

---

## まとめ

AIに質問させることで：
- **暴走**を防ぐ：勝手な推測を防ぎ、スコープを明確化
- **手抜き**を防ぐ：テスト方法を明確化し、ハードコード実装を防ぐ
- **忘れっぽさ**を防ぐ：設計書に明記させ、Compact後も参照可能に

さらに、複数案提案とペルソナごとのMoSCoW分析で：
- **優先順位が明確**になり、重要な機能に絞り込める
- **意思決定の質**が向上し、手戻りが削減される

「質問させる」ことは、AI駆動開発における最も重要なGuardrailsの1つ。
