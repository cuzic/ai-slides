# 23. ユーザーストーリーの書き方

**最終更新**: 2025-01-07
**カテゴリ**: 開発手法・プラクティス（要件定義フェーズ）
**難易度**: ⭐⭐ (初級〜中級)

## 📋 目次

1. [概要](#概要)
2. [ユーザーストーリーとは](#ユーザーストーリーとは)
3. [AI駆動開発における重要性](#ai駆動開発における重要性)
4. [基本フォーマット](#基本フォーマット)
5. [INVEST原則](#invest原則)
6. [ペルソナ設定とMoSCoW分析](#ペルソナ設定とmoscow分析)
7. [書き方のベストプラクティス](#書き方のベストプラクティス)
8. [Java/Spring Boot開発での実例](#javaspring-boot開発での実例)
9. [AI問題への対策](#ai問題への対策)
10. [アンチパターン](#アンチパターン)
11. [ユーザーストーリーマッピング](#ユーザーストーリーマッピング)
12. [まとめ](#まとめ)
13. [参考資料](#参考資料)

---

## 概要

### ユーザーストーリーとは

**ユーザーストーリー（User Story）**は、アジャイル開発における最小の作業単位で、エンドユーザーの視点から書かれたソフトウェア機能の説明です。

**従来の要求仕様書との違い**:
```
従来の要件定義:
「システムは、ユーザー認証機能を実装しなければならない。
認証方式はJWT（JSON Web Token）を使用し、有効期限は24時間とする。
データベースにはユーザーテーブル（user_id, email, password_hash）を作成し...」

ユーザーストーリー:
「会員として、メールアドレスとパスワードでログインしたい。
なぜなら、自分の注文履歴を確認したいからだ。」
```

**違い**:
- 従来: **How（どう実装するか）**を詳細に記述
- ユーザーストーリー: **Who（誰が）**、**What（何をしたい）**、**Why（なぜ）**に焦点

### なぜユーザーストーリーが必要か

1. **ユーザー価値の明確化**
   - 「この機能は誰のため？何のため？」を常に意識
   - 無駄な機能開発を防ぐ

2. **対話の促進**
   - ステークホルダー全員が理解できる言葉
   - 「これ、本当に必要？」「別の方法は？」という議論を生む

3. **小さく分割**
   - 1〜3日で完成する単位に分割
   - イテレーション（スプリント）ごとに価値を提供

4. **AI駆動開発での指示書**
   - AIへの明確な指示
   - 暴走（Scope Creep）・手抜き（Reward Hacking）の防止

---

## ユーザーストーリーとは

### 定義

Atlassianの定義:
> "A user story is the smallest unit of work in an agile framework. It's an end goal, not a feature, expressed from the software user's perspective."
> （ユーザーストーリーは、アジャイルフレームワークにおける最小の作業単位です。ソフトウェアユーザーの視点から表現された、機能ではなく最終目標です。）

### 3つの要素

| 要素 | 英語 | 説明 | 例 |
|------|------|------|-----|
| 役割 | As a | 誰が使うか（ペルソナ） | 会員として |
| 目的 | I want | 何をしたいか | 商品をカートに追加したい |
| 利益 | So that | なぜそれが必要か | 後でまとめて購入できるようにするため |

### テンプレート

```
As a [ペルソナ],
I want [目的],
So that [利益].
```

日本語版:
```
[ペルソナ] として、
[目的] をしたい。
なぜなら、[利益] だからだ。
```

---

## AI駆動開発における重要性

### AI問題とユーザーストーリー

| AI問題 | ユーザーストーリーによる対策 | 具体例 |
|-------|-------------------------|--------|
| **Scope Creep（暴走）** | 「So that」で目的を明確化 → 不要な機能を実装しない | ❌「ログイン機能」→ AIが管理画面・パスワードリセット・多要素認証を勝手に追加<br>✅「会員として、メールとパスワードでログインしたい。なぜなら、注文履歴を確認したいから」→ ログイン機能のみ実装 |
| **Reward Hacking（手抜き）** | 「So that」で期待される結果を明示 | ❌「商品検索機能を作って」→ AIが検索ボックスだけ作る<br>✅「顧客として、商品名で検索したい。なぜなら、欲しい商品をすぐに見つけたいから」→ 検索結果表示まで実装 |
| **Context Limitations（忘れっぽさ）** | ストーリーをGit管理で外部化 | `docs/user-stories/US-001-login.md` として保存 → Compact後も参照可能 |
| **Hallucination（虚偽）** | 「As a」でペルソナを明確化 → 存在しないユーザー向け機能を防ぐ | ❌「管理者として...」→ 管理者機能が要件にない場合、AIが勝手に実装<br>✅ 要件定義で「会員」「店舗スタッフ」のみ定義 → それ以外は実装しない |

### Trust but Verifyとの関係

**Layer 0（事前防止）: ユーザーストーリーでガードレール**
```
AI問題を未然に防ぐ:
- 「So that」で目的明示 → Scope Creep防止
- 小さく分割 → Context Limitationsに対応
- テスト可能な形式 → 受入条件に変換可能
```

---

## 基本フォーマット

### 標準フォーマット

**英語**:
```
As a [persona],
I want [software goal],
So that [result].
```

**日本語**:
```
[ペルソナ] として、
[ソフトウェアの目標] をしたい。
なぜなら、[結果] だからだ。
```

### 実例

#### 例1: ECサイトのカート機能

```
As a 会員,
I want 商品をカートに追加したい,
So that 後でまとめて購入できる.
```

日本語:
```
会員として、
商品をカートに追加したい。
なぜなら、後でまとめて購入できるようにするためだ。
```

#### 例2: 在庫管理システム

```
As a 店舗スタッフ,
I want 商品の在庫数をリアルタイムで確認したい,
So that 売り切れ前に発注できる.
```

#### 例3: 注文管理システム

```
As a 管理者,
I want 注文ステータスを一覧で確認したい,
So that 配送遅延を早期に発見できる.
```

---

## INVEST原則

### 概要

**INVEST**は、良いユーザーストーリーの品質をチェックするガイドラインです（Bill Wakeが提唱）。

| 頭文字 | 原則 | 意味 | チェックポイント |
|-------|------|------|-----------------|
| **I** | Independent（独立している） | 他のストーリーに依存しない | このストーリー単独で開発・テストできるか？ |
| **N** | Negotiable（交渉可能） | 詳細は議論で決める | 実装方法を固定していないか？ |
| **V** | Valuable（価値がある） | ユーザーに価値を提供 | 「So that」で価値を説明できるか？ |
| **E** | Estimable（見積り可能） | 工数見積りができる | 曖昧すぎて見積もれないか？ |
| **S** | Small（小さい） | 1スプリントで完成 | 1〜3日で終わるか？ |
| **T** | Testable（テスト可能） | 完了判定ができる | 受入条件を書けるか？ |

### 各原則の詳細

#### I - Independent（独立している）

**良い例**:
```
US-001: 会員として、メールアドレスでログインしたい。なぜなら、自分の注文履歴を確認したいからだ。
US-002: 会員として、注文履歴を一覧で確認したい。なぜなら、過去の購入を振り返りたいからだ。
```

→ US-001とUS-002は独立。US-001がなくても、US-002はモックデータでテスト可能。

**悪い例**:
```
US-001: ログイン機能のデータベーステーブルを作成
US-002: ログイン機能のAPIを実装
US-003: ログイン画面のUIを作成
```

→ US-001→US-002→US-003の順番でしか開発できない（依存関係が強い）。

#### N - Negotiable（交渉可能）

**良い例**:
```
会員として、パスワードを忘れた場合にリセットしたい。
なぜなら、再度ログインできるようにするためだ。
```

→ 実装方法（メールリンク、SMS、秘密の質問）は後で議論。

**悪い例**:
```
会員として、パスワードリセット用のワンタイムトークンをJWT形式でメール送信し、
有効期限30分で実装したい。
```

→ 実装方法を固定しすぎ。技術的詳細はストーリーに含めない。

#### V - Valuable（価値がある）

**良い例**:
```
顧客として、商品レビューを投稿したい。
なぜなら、他の購入者の参考になるからだ。
```

→ 「他の購入者の参考」という明確な価値。

**悪い例**:
```
開発者として、ログをJSON形式で出力したい。
なぜなら、ログ解析ツールが使いやすいからだ。
```

→ 開発者の利便性であり、エンドユーザーへの価値ではない（技術的タスクはストーリーではない）。

#### E - Estimable（見積り可能）

**良い例**:
```
会員として、商品をカートに追加したい。
なぜなら、後でまとめて購入できるようにするためだ。
```

→ 「カート追加ボタン」「カート一覧画面」「数量変更」など、作業が具体的に想像できる。

**悪い例**:
```
会員として、最高のショッピング体験をしたい。
なぜなら、満足度を高めたいからだ。
```

→ 「最高の体験」が曖昧すぎて見積もれない。

#### S - Small（小さい）

**良い例（1〜3日で完成）**:
```
会員として、商品詳細ページで「カートに追加」ボタンをクリックしたい。
なぜなら、その商品を購入候補に入れたいからだ。
```

**悪い例（大きすぎる、Epic）**:
```
会員として、ECサイトで買い物をしたい。
なぜなら、商品を購入したいからだ。
```

→ これはEpic（複数ストーリーの集合）。以下のように分割：
- US-001: 商品一覧を閲覧
- US-002: 商品詳細を確認
- US-003: カートに追加
- US-004: カート内容を確認
- US-005: 注文手続き

#### T - Testable（テスト可能）

**良い例**:
```
会員として、商品検索で「カメラ」と入力したい。
なぜなら、カメラ関連商品を探したいからだ。

受入条件:
- GIVEN: 商品一覧画面を表示
- WHEN: 検索バーに「カメラ」と入力してEnter
- THEN: カテゴリに「カメラ」を含む商品のみ表示される
- AND: 検索結果件数が表示される
```

→ 受入条件（Acceptance Criteria）が明確で、テスト可能。

**悪い例**:
```
会員として、使いやすい検索機能を使いたい。
なぜなら、ストレスなく商品を探したいからだ。
```

→ 「使いやすい」「ストレスなく」が主観的で、テストできない。

---

## ペルソナ設定とMoSCoW分析

### なぜペルソナが重要か

**ペルソナ(Persona)**は、ソフトウェアを使う典型的なユーザー像を具体化したもの。
ユーザーストーリーの「As a(誰が)」を明確にし、AIにとっても人間にとっても理解しやすくする。

### AI駆動開発におけるペルソナの効果

| 効果 | 説明 | AI問題への対策 |
|------|------|---------------|
| **理解しやすさ** | 「会員として」より「忙しいビジネスパーソンとして」の方が具体的 | AIが文脈を理解しやすい |
| **優先順位付け** | ペルソナごとにMust/Should/Could/Won'tを判断 | Scope Creep(暴走)防止 |
| **機能絞り込み** | 主要ペルソナのMust機能のみに集中 | 開発期間1/3に短縮 |
| **Hallucination防止** | 定義していないペルソナの機能は実装しない | 虚偽報告防止 |

### ペルソナ設定例(TODO管理アプリ)

#### ペルソナ1: 忙しいビジネスパーソン(田中さん、35歳、営業職)

**プロフィール**:
- 1日に50件以上のタスクを管理
- 移動中にスマホでTODO確認
- 優先度による絞り込みが重要

**ニーズ**:
- 素早くTODO追加
- 優先度フィルター
- シンプルなUI

#### ペルソナ2: フリーランスエンジニア(佐藤さん、28歳)

**プロフィール**:
- プロジェクト単位でタスク管理
- 期限管理が重要
- コマンドライン操作が好き

**ニーズ**:
- 期限設定・通知
- プロジェクトタグ
- CLI対応(将来)

#### ペルソナ3: 主婦(鈴木さん、42歳)

**プロフィール**:
- 家事・買い物・子供の予定を管理
- シンプルなUIが重要
- リマインダー機能が欲しい

**ニーズ**:
- 直感的なUI
- リマインダー
- カテゴリ分け

### MoSCoW分析とは

**MoSCoW**は、要件の優先順位を4つに分類する手法。

| 分類 | 意味 | 説明 | 判断基準 |
|------|------|------|----------|
| **M**ust | 必須 | これがないとサービスが成立しない | MVPに含める |
| **S**hould | 重要 | あるべきだが、なくても動く | Phase 2で実装 |
| **C**ould | あればいい | あると嬉しいが、優先度は低い | Phase 3で実装 |
| **W**on't | 今回はやらない | 将来検討するが、今回は対象外 | バックログに記録 |

### ペルソナごとのMoSCoW分析

#### Claude Codeへの指示例

```
TODO管理アプリの要件定義を行います。
以下の3つのペルソナを設定し、それぞれのペルソナにとってのユーザーストーリーを作成してください。
各ユーザーストーリーにMoSCoW分析(Must/Should/Could/Won't)を適用してください。

【ペルソナ1】忙しいビジネスパーソン(田中さん、35歳、営業職)
- 1日に50件以上のタスクを管理
- 移動中にスマホでTODO確認
- 優先度による絞り込みが重要

【ペルソナ2】フリーランスエンジニア(佐藤さん、28歳)
- プロジェクト単位でタスク管理
- 期限管理が重要
- コマンドライン操作が好き

【ペルソナ3】主婦(鈴木さん、42歳)
- 家事・買い物・子供の予定を管理
- シンプルなUIが重要
- リマインダー機能が欲しい

全ペルソナに共通する「Must」要件を抽出し、MVPスコープを決定してください。
```

#### AIの提案例

```markdown
## ペルソナ1: 忙しいビジネスパーソン(田中さん)

### US-101: 優先度フィルター
「忙しいビジネスパーソンとして、TODOを優先度でフィルタリングしたい、なぜなら重要なタスクに集中したいから」
- **MoSCoW**: Must

### US-102: スマホ対応
「忙しいビジネスパーソンとして、スマホでTODOを確認したい、なぜなら移動中にも確認したいから」
- **MoSCoW**: Should(MVP後に対応)

### US-103: 一括削除
「忙しいビジネスパーソンとして、完了済みTODOを一括削除したい、なぜなら1日50件も処理するから」
- **MoSCoW**: Could

## ペルソナ2: フリーランスエンジニア(佐藤さん)

### US-201: 期限管理
「フリーランスエンジニアとして、TODOに期限を設定したい、なぜなら納期を守りたいから」
- **MoSCoW**: Must

### US-202: CLI対応
「フリーランスエンジニアとして、CLIでTODO操作したい、なぜならターミナル作業が多いから」
- **MoSCoW**: Won't(今回は対応しない、Web UIのみ)

## ペルソナ3: 主婦(鈴木さん)

### US-301: シンプルなUI
「主婦として、シンプルで直感的なUIでTODO管理したい、なぜなら複雑な操作は苦手だから」
- **MoSCoW**: Must

### US-302: リマインダー
「主婦として、期限前にリマインダーが欲しい、なぜなら子供の予定を忘れたくないから」
- **MoSCoW**: Should(MVP後に対応)

## 全ペルソナ共通のMust要件

上記から、全ペルソナに共通する「Must」要件を抽出:
1. TODO作成・一覧表示・更新・削除(CRUD基本)
2. 優先度設定(HIGH/MEDIUM/LOW)
3. ステータス管理(TODO/IN_PROGRESS/DONE)
4. シンプルで直感的なUI
5. 期限設定

**MVP(Minimum Viable Product)スコープ**: 上記5つのみに絞る

**Phase 2(MVP後)**: スマホ対応、リマインダー

**Phase 3(将来)**: 一括削除、タグ管理、プロジェクト分類

**Won't(今回対象外)**: CLI対応、多要素認証、API公開
```

### MoSCoW分析の効果

**Mustを20-30%に絞ることで**:
- 開発期間を1/3に短縮(例:3ヶ月 → 1ヶ月)
- 早期リリースで市場検証
- フィードバックを次のPhaseに反映

**AI駆動開発での活用**:
```
Claude Codeへの指示:
「ペルソナ分析結果(docs/personas/moscow-analysis.md)を参照し、
MVPスコープの機能のみを実装してください。

実装対象(Must):
- TODO作成・一覧表示・更新・削除
- 優先度設定(HIGH/MEDIUM/LOW)
- ステータス管理(TODO/IN_PROGRESS/DONE)
- シンプルなUI
- 期限設定

実装しないこと(Should/Could/Won't):
- スマホ対応(Phase 2)
- リマインダー(Phase 2)
- 一括削除(Phase 3)
- CLI対応(Won't)
```

### ペルソナとMoSCoW分析のまとめ

| 項目 | 効果 | AI問題への対策 |
|------|------|---------------|
| **ペルソナ設定** | ユーザー像を具体化 | AIと人間の理解を一致 |
| **MoSCoW分析** | 優先順位を明確化 | Scope Creep(暴走)防止 |
| **Must絞り込み** | 開発期間を1/3に短縮 | Context Limitationsに対応 |
| **共通Must抽出** | MVPスコープ決定 | 手戻り削減 |

---

## 書き方のベストプラクティス

### 1. ユーザー視点で書く

**Good**:
```
顧客として、商品レビューを星5段階で評価したい。
なぜなら、簡単に満足度を表現したいからだ。
```

**Bad**:
```
開発者として、rating カラムを追加したい。
なぜなら、データベース設計が完成するからだ。
```

### 2. 技術詳細を避ける

**Good**:
```
会員として、パスワードを安全に保存してほしい。
なぜなら、アカウントの不正利用を防ぎたいからだ。
```

→ 「どう実装するか（bcrypt, Argon2等）」は書かない。

**Bad**:
```
会員として、パスワードをbcryptでハッシュ化し、
ソルトはランダム生成、ストレッチング回数は10回で保存したい。
```

### 3. 1ストーリー = 1つの価値

**Good**:
```
US-001: 会員として、商品をカートに追加したい。
US-002: 会員として、カート内の商品数量を変更したい。
US-003: 会員として、カートから商品を削除したい。
```

**Bad**:
```
US-001: 会員として、カート機能を使いたい。
（追加・変更・削除・合計金額表示・クーポン適用...）
```

### 4. ステークホルダー全員が理解できる言葉

**Good**:
```
店舗スタッフとして、在庫が10個以下になったら通知を受け取りたい。
なぜなら、売り切れ前に発注できるからだ。
```

→ エンジニアでなくても理解できる。

**Bad**:
```
システムとして、inventory_countが閾値threshold_valueを下回った場合、
NotificationServiceのsendAlert()メソッドを呼び出したい。
```

### 5. 「So that」を省略しない

**Good**:
```
会員として、注文履歴をCSVでダウンロードしたい。
なぜなら、確定申告の資料として使いたいからだ。
```

→ 「確定申告の資料」という具体的な価値。

**Bad**:
```
会員として、注文履歴をCSVでダウンロードしたい。
```

→ 「なぜ必要？」が不明。本当に必要な機能か議論できない。

---

## Java/Spring Boot開発での実例

### ケーススタディ: ECサイト開発

#### Epic（大きな機能群）

```
Epic: 商品購入機能
```

#### ユーザーストーリー分割

**US-001: 商品一覧表示**
```
会員として、
商品一覧をカテゴリ別に閲覧したい。
なぜなら、欲しい商品を効率的に探したいからだ。

受入条件:
- GIVEN: トップページにアクセス
- WHEN: 「家電」カテゴリをクリック
- THEN: 家電カテゴリの商品のみ表示される
- AND: 各商品に画像・名前・価格・評価が表示される

技術メモ（AI実装時の参照用）:
- Controller: ProductController#list()
- Service: ProductService#findByCategory()
- Entity: Product.java
- Template: products/list.html (Thymeleaf)
```

**US-002: 商品検索**
```
顧客として、
商品名でキーワード検索したい。
なぜなら、特定の商品をすぐに見つけたいからだ。

受入条件:
- GIVEN: 商品一覧画面を表示
- WHEN: 検索バーに「ノートパソコン」と入力してEnter
- THEN: 商品名に「ノートパソコン」を含む商品のみ表示される
- AND: 検索結果件数が「3件見つかりました」のように表示される
- AND: 該当商品がない場合「該当する商品が見つかりませんでした」と表示

技術メモ:
- Controller: ProductController#search()
- Service: ProductService#searchByKeyword()
- Query: LIKE '%keyword%' (後でElasticsearch検討)
```

**US-003: カート追加**
```
会員として、
商品詳細ページで「カートに追加」ボタンをクリックしたい。
なぜなら、後でまとめて購入できるようにするためだ。

受入条件:
- GIVEN: 会員ログイン済み、商品詳細ページを表示
- WHEN: 「カートに追加」ボタンをクリック
- THEN: カートアイコンのバッジ数が+1される
- AND: 「カートに追加しました」というトースト通知が表示される
- AND: 同じ商品を再度追加した場合、数量が+1される（重複行は作らない）

技術メモ:
- Controller: CartController#add()
- Service: CartService#addItem()
- Entity: Cart.java, CartItem.java
- JSON API: POST /api/cart/items
```

**US-004: カート確認**
```
会員として、
カート画面で追加した商品の一覧を確認したい。
なぜなら、購入前に内容を確認したいからだ。

受入条件:
- GIVEN: カートに商品が3点追加済み
- WHEN: ヘッダーのカートアイコンをクリック
- THEN: カート画面に遷移し、商品一覧が表示される
- AND: 各商品に画像・名前・単価・数量・小計が表示される
- AND: 画面下部に合計金額（税込）が表示される

技術メモ:
- Controller: CartController#view()
- Service: CartService#getCartItems()
- Template: cart/view.html
```

**US-005: カート数量変更**
```
会員として、
カート内の商品数量を変更したい。
なぜなら、購入数を調整したいからだ。

受入条件:
- GIVEN: カート画面を表示、商品Aが数量2
- WHEN: 商品Aの「+」ボタンをクリック
- THEN: 数量が3に変更される
- AND: 小計と合計金額が再計算される
- WHEN: 「-」ボタンで数量を0にする
- THEN: 「商品を削除しますか？」確認ダイアログ表示
- AND: 「はい」で商品がカートから削除される

技術メモ:
- API: PUT /api/cart/items/{itemId}
- Service: CartService#updateQuantity()
```

### Claude Codeへのプロンプト例

```
以下のユーザーストーリーを実装してください：

**US-003: カート追加**
```
会員として、
商品詳細ページで「カートに追加」ボタンをクリックしたい。
なぜなら、後でまとめて購入できるようにするためだ。

受入条件:
- GIVEN: 会員ログイン済み、商品詳細ページを表示
- WHEN: 「カートに追加」ボタンをクリック
- THEN: カートアイコンのバッジ数が+1される
- AND: 「カートに追加しました」というトースト通知が表示される
- AND: 同じ商品を再度追加した場合、数量が+1される（重複行は作らない）
```

**技術スタック**:
- Spring Boot 3.2
- Spring Data JPA
- Thymeleaf + Bootstrap 5
- H2 Database (開発環境)

**実装要件**:
1. CartController#add() を実装
2. CartService#addItem() を実装
3. Cart.java, CartItem.java エンティティを実装
4. 受入条件をすべて満たすこと
5. 実装後、受入条件に基づくテストコードを生成してください

**実装しないこと**:
- 決済機能（US-006で別途実装）
- クーポン機能（US-007で別途実装）
- ゲスト購入（US-008で別途実装）
```

→ ユーザーストーリーを明示することで、Scope Creep（暴走）を防ぐ。

---

## AI問題への対策

### 1. Scope Creep（暴走）対策

**問題**: AIが指示していない機能を勝手に実装

**対策**: 「So that」で目的を明確化 + 「実装しないこと」を明記

**例**:
```
US-003: カート追加

会員として、商品をカートに追加したい。
なぜなら、後でまとめて購入できるようにするためだ。

実装範囲:
- カート追加機能のみ

実装しないこと:
- 決済機能
- クーポン機能
- ゲスト購入
- 在庫チェック（US-010で実装）
```

### 2. Reward Hacking（手抜き）対策

**問題**: AIが最低限の実装だけして完了と報告

**対策**: 受入条件（Acceptance Criteria）を詳細に記載

**例**:
```
US-002: 商品検索

顧客として、商品名でキーワード検索したい。
なぜなら、特定の商品をすぐに見つけたいからだ。

受入条件:
- GIVEN: 商品一覧画面を表示
- WHEN: 検索バーに「ノートパソコン」と入力してEnter
- THEN: 商品名に「ノートパソコン」を含む商品のみ表示される
- AND: 検索結果件数が「3件見つかりました」のように表示される ← これがないとAIは省略する
- AND: 該当商品がない場合「該当する商品が見つかりませんでした」と表示 ← エラーケースも明記
```

### 3. Context Limitations（忘れっぽさ）対策

**問題**: トークン制限でCompact後、ユーザーストーリーの情報が失われる

**対策**: ユーザーストーリーをGit管理で外部化

**ディレクトリ構成**:
```bash
docs/
└── user-stories/
    ├── README.md                  # 全ストーリーの一覧
    ├── Epic-01-product-browsing.md
    ├── US-001-product-list.md
    ├── US-002-product-search.md
    ├── US-003-cart-add.md
    └── US-004-cart-view.md
```

**Claude Codeへのプロンプト**:
```
「docs/user-stories/US-003-cart-add.md を参照して、
カート追加機能を実装してください。」
```

→ Compact後も、ファイルパスを指定すれば情報を復元可能。

### 4. Hallucination（虚偽）対策

**問題**: 存在しないユーザー向け機能を実装

**対策**: ペルソナを明確に定義し、それ以外は実装しない

**例**:
```
定義済みペルソナ:
- 会員（一般顧客）
- 店舗スタッフ

定義していないペルソナ:
- 管理者 ← この機能は今回実装しない
- ゲストユーザー ← US-008で別途実装
```

**プロンプト**:
```
「以下のペルソナのみ実装してください：
- 会員（一般顧客）
- 店舗スタッフ

管理者機能、ゲストユーザー機能は実装しないでください。」
```

---

## アンチパターン

### アンチパターン1: 技術的タスクをストーリーにする

**Bad**:
```
開発者として、Userテーブルにlast_login_atカラムを追加したい。
なぜなら、最終ログイン日時を記録したいからだ。
```

**Good**:
```
管理者として、各会員の最終ログイン日時を確認したい。
なぜなら、非アクティブユーザーを特定したいからだ。

技術メモ:
- Userテーブルにlast_login_atカラム追加
- ログイン時にタイムスタンプ更新
```

### アンチパターン2: 大きすぎるストーリー（Epic）

**Bad**:
```
会員として、ECサイトで買い物をしたい。
なぜなら、商品を購入したいからだ。
```

→ これはEpic。以下のように分割：

**Good**:
```
Epic: 商品購入機能

- US-001: 商品一覧表示
- US-002: 商品検索
- US-003: カート追加
- US-004: カート確認
- US-005: 注文手続き
- US-006: 決済
```

### アンチパターン3: 「So that」が曖昧

**Bad**:
```
会員として、ログインしたい。
なぜなら、便利だからだ。
```

**Good**:
```
会員として、メールアドレスとパスワードでログインしたい。
なぜなら、自分の注文履歴を確認したいからだ。
```

### アンチパターン4: 複数の価値を1ストーリーに詰め込む

**Bad**:
```
会員として、商品をカートに追加し、数量を変更し、削除し、
クーポンを適用し、合計金額を確認したい。
```

**Good**:
```
US-003: カート追加
US-004: 数量変更
US-005: カートから削除
US-006: クーポン適用
US-007: 合計金額表示
```

---

## ユーザーストーリーマッピング

### 概要

**ユーザーストーリーマッピング**は、ユーザーストーリーを付箋紙に書き出して、時系列と優先度に沿ってマッピングする手法です。

### マッピングの構造

```
横軸: 時系列（ユーザージャーニー）
縦軸: 優先度（上: 必須、下: Nice to have）
```

### ECサイトの例

```
┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
│  商品を探す  │  商品を選ぶ  │  カート確認  │   注文する   │  注文確認   │
│             │             │             │             │             │
│  ────────  │  ────────  │  ────────  │  ────────  │  ────────  │
│             │             │             │             │             │
│ US-001      │ US-003      │ US-006      │ US-009      │ US-012      │
│ 商品一覧    │ 商品詳細    │ カート確認  │ 注文入力    │ 注文完了    │
│ 閲覧        │ 表示        │             │             │ 画面        │
│             │             │             │             │             │
│ US-002      │ US-004      │ US-007      │ US-010      │ US-013      │
│ カテゴリ    │ カート      │ 数量変更    │ 配送先      │ 注文履歴    │
│ フィルター  │ 追加        │             │ 入力        │ 確認        │
│             │             │             │             │             │
│ US-003      │ US-005      │ US-008      │ US-011      │             │
│ キーワード  │ レビュー    │ クーポン    │ 決済        │             │
│ 検索        │ 閲覧        │ 適用        │             │             │
│             │             │             │             │             │
└─────────────┴─────────────┴─────────────┴─────────────┴─────────────┘
```

### MVP（Minimum Viable Product）の決定

**リリース1（MVP）**:
```
横一列の最上段のみ実装:
- US-001: 商品一覧閲覧
- US-003: 商品詳細表示
- US-006: カート確認
- US-009: 注文入力
- US-012: 注文完了画面

→ 最低限の購入フローが完成
```

**リリース2**:
```
2段目を追加:
- US-002: カテゴリフィルター
- US-004: カート追加
- US-007: 数量変更
- US-010: 配送先入力
- US-013: 注文履歴確認

→ ユーザビリティ向上
```

### AI駆動開発での活用

```
# Claude Codeへのプロンプト
「ユーザーストーリーマッピング（docs/user-story-map.md）の
リリース1（MVP）のストーリーのみを実装してください。

実装対象:
- US-001: 商品一覧閲覧
- US-003: 商品詳細表示
- US-006: カート確認
- US-009: 注文入力
- US-012: 注文完了画面

実装しないこと:
- US-002以降のリリース2機能
- US-014以降の将来機能
」
```

→ Scope Creep（暴走）を防ぐ。

---

## まとめ

### ユーザーストーリーの重要ポイント

1. **3要素を明確に**
   - As a（誰が）
   - I want（何をしたい）
   - So that（なぜ）

2. **INVEST原則を守る**
   - Independent（独立）
   - Negotiable（交渉可能）
   - Valuable（価値）
   - Estimable（見積り可能）
   - Small（小さい）
   - Testable（テスト可能）

3. **AI駆動開発での活用**
   - Scope Creep対策: 「So that」で目的明確化
   - Reward Hacking対策: 受入条件を詳細記載
   - Context Limitations対策: Git管理で外部化
   - Hallucination対策: ペルソナを明確に定義

### 要件定義フェーズでの位置づけ

```
要件定義フェーズ:
1. ユーザーストーリー作成（本記事）
   ↓
設計フェーズ:
2. 受入基準を箇条書きでまとめ（次の記事: 24-acceptance-criteria.md）
   ↓
タスク分解フェーズ:
3. GIVEN WHEN THEN形式のBDDテストシナリオ定式化（既存: 01-given-when-then-bdd.md）
```

### Trust but Verifyとの関係

| 段階 | 成果物 | AI問題への対策 |
|------|--------|---------------|
| 要件定義 | ユーザーストーリー | Scope Creep/Hallucination事前防止 |
| 設計 | 受入基準 | Reward Hacking検出 |
| 実装 | BDDテストシナリオ | 自動検証（Layer 1） |

---

## 参考資料

### 公式ドキュメント・ガイド

1. **Atlassian**
   - [User stories with examples and a template](https://www.atlassian.com/agile/project-management/user-stories)
   - [ユーザー ストーリー | 例とテンプレート](https://www.atlassian.com/ja/agile/project-management/user-stories)

2. **Asana**
   - [User Stories Explained: Tips, Templates, and Examples [2025]](https://asana.com/resources/user-stories)
   - [ユーザーストーリー: ユーザー価値の高め方 (3 つの実例付) [2025]](https://asana.com/ja/resources/user-stories)

3. **Scaled Agile Framework (SAFe)**
   - [A User Story Primer](https://framework.scaledagile.com/wp-content/uploads/2025/04/A-user-story-primer.pdf)
   - [Story - Scaled Agile Framework](https://framework.scaledagile.com/story/)

4. **Agile Business Consortium**
   - [Agile Requirements and User Stories](https://www.agilebusiness.org/dsdm-project-framework/requirements-and-user-stories.html)

### 技術記事・ブログ

5. **AltexSoft**
   - [User Stories: Documenting Requirements in Agile](https://www.altexsoft.com/blog/user-stories/)

6. **Teaching Agile**
   - [User Stories vs Use Cases: Key Differences & When to Use Each (2025)](https://teachingagile.com/agile/user-story/user-stories-vs-use-cases)

7. **日本語リソース**
   - [ユーザーストーリーとは？アジャイル開発における活用例や書き方を解説](https://spice-factory.co.jp/development/user-story/) - スパイスファクトリー
   - [アジャイルにおけるユーザーストーリーとは？書き方例とテンプレートを解説](https://abi-agile.com/user-stories/)
   - [【保存版】ユーザーストーリーの基本｜アジャイル開発に携わるメンバーが抑えるべきポイント](https://enlyt.co.jp/blog/userstory/)
   - [ユーザーストーリーとは？書き方例やマッピングの方法を紹介](https://it-trend.jp/development_tools/article/32-0045) - ITトレンド

### 関連トピック

- [01. GIVEN WHEN THEN - BDD形式の受入条件](./01-given-when-then-bdd.md)
- [24. 受入基準とチェックリスト](./24-acceptance-criteria.md)（次の記事）
- [13. Reward Hacking in AI](./13-reward-hacking-ai.md)
- [16. AI Scope Creep（暴走）](./16-ai-scope-creep.md)
- [17. Context Limitations（忘れっぽさ）](./17-context-limitations.md)
- [19. Guardrails（ガードレール）](./19-guardrails.md)

---

**次のトピック**: [24. 受入基準とチェックリスト](./24-acceptance-criteria.md)
**前のトピック**: [22. 画面設計とVibe Coding](./22-screen-design-and-vibe-coding.md)

---

**📝 更新履歴**:
- 2025-01-07: 初版作成（WEB検索による最新情報反映）
