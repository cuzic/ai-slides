<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIÈßÜÂãïÈñãÁô∫„Çª„Éü„Éä„Éº - „Çπ„É©„Ç§„Éâ„Éì„É•„Éº„Ç¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', sans-serif;
            background: #1a1a2e;
            color: #fff;
            min-height: 100vh;
        }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            background: #16213e;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 1.2rem;
            color: #e94560;
        }

        .header-nav {
            display: flex;
            gap: 1rem;
        }

        .header-nav button {
            background: #0f3460;
            border: none;
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .header-nav button:hover {
            background: #e94560;
        }

        .header-nav button.active {
            background: #e94560;
        }

        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä */
        .container {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* „Çµ„Ç§„Éâ„Éê„ÉºÔºàÁõÆÊ¨°Ôºâ */
        .sidebar {
            width: 300px;
            background: #16213e;
            overflow-y: auto;
            transition: transform 0.3s;
            border-right: 1px solid #0f3460;
        }

        .sidebar.hidden {
            transform: translateX(-300px);
            width: 0;
        }

        .toc-section {
            border-bottom: 1px solid #0f3460;
        }

        .toc-section-title {
            padding: 1rem;
            background: #0f3460;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toc-section-title:hover {
            background: #1a4a7a;
        }

        .toc-items {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s;
        }

        .toc-items.expanded {
            max-height: 2000px;
        }

        .toc-item {
            padding: 0.5rem 1rem 0.5rem 2rem;
            cursor: pointer;
            font-size: 0.85rem;
            border-left: 3px solid transparent;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .toc-item:hover {
            background: #1a4a7a;
        }

        .toc-item.active {
            background: #0f3460;
            border-left-color: #e94560;
        }

        .toc-item.section-title {
            font-weight: bold;
            color: #e94560;
        }

        /* „Çπ„É©„Ç§„Éâ„Éì„É•„Éº„Ç¢ */
        .viewer {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            position: relative;
        }

        .slide-container {
            max-width: 100%;
            max-height: calc(100vh - 200px);
            aspect-ratio: 16 / 9;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .slide-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */
        .nav-controls {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .nav-btn {
            background: #0f3460;
            border: none;
            color: #fff;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-btn:hover:not(:disabled) {
            background: #e94560;
            transform: scale(1.1);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .slide-info {
            text-align: center;
            min-width: 200px;
        }

        .slide-title {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: #fff;
        }

        .slide-counter {
            font-size: 0.85rem;
            color: #888;
        }

        /* „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº */
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #0f3460;
        }

        .progress-fill {
            height: 100%;
            background: #e94560;
            transition: width 0.3s;
        }

        /* „Ç≠„Éº„Éú„Éº„Éâ„Éí„É≥„Éà */
        .keyboard-hint {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 0.75rem;
            color: #666;
        }

        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞ */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #0f3460;
            border-top-color: #e94560;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                z-index: 100;
                height: calc(100vh - 60px);
            }

            .slide-container {
                max-height: calc(100vh - 250px);
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>AIÈßÜÂãïÈñãÁô∫„Çª„Éü„Éä„Éº</h1>
        <nav class="header-nav">
            <button onclick="toggleSidebar()" id="toc-btn">üìë ÁõÆÊ¨°</button>
            <button onclick="selectSection(0)" data-section="0">01 ÂÖ•ÈñÄÁ∑®</button>
            <button onclick="selectSection(1)" data-section="1">02 Ë®≠Ë®àÁ∑®</button>
            <button onclick="selectSection(2)" data-section="2">03 ÂÆüË£ÖÁ∑®</button>
        </nav>
    </header>

    <div class="container">
        <aside class="sidebar" id="sidebar">
            <div id="toc-content">
                <div class="loading">
                    <div class="spinner"></div>
                    <p style="margin-top: 1rem;">Ë™≠„ÅøËæº„Åø‰∏≠...</p>
                </div>
            </div>
        </aside>

        <main class="viewer">
            <div class="slide-container" id="slide-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <p style="margin-top: 1rem; color: #fff;">„Çπ„É©„Ç§„Éâ„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                </div>
            </div>

            <div class="nav-controls">
                <button class="nav-btn" id="prev-btn" onclick="prevSlide()">‚óÄ</button>
                <div class="slide-info">
                    <div class="slide-title" id="slide-title">-</div>
                    <div class="slide-counter" id="slide-counter">- / -</div>
                </div>
                <button class="nav-btn" id="next-btn" onclick="nextSlide()">‚ñ∂</button>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>

            <div class="keyboard-hint">
                ‚Üê ‚Üí „Ç≠„Éº„Åæ„Åü„ÅØ„Çπ„Éö„Éº„Çπ„Åß„Éö„Éº„Ç∏ÈÄÅ„Çä
            </div>
        </main>
    </div>

    <script>
        let manifest = [];
        let currentSection = 0;
        let currentSlide = 0;
        let allSlides = [];

        async function loadManifest() {
            try {
                const response = await fetch('manifest.json');
                manifest = await response.json();
                buildTOC();
                buildAllSlides();
                selectSection(0);
            } catch (error) {
                console.error('„Éû„Éã„Éï„Çß„Çπ„Éà„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:', error);
                document.getElementById('toc-content').innerHTML = '<p style="padding: 1rem;">„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</p>';
            }
        }

        function buildAllSlides() {
            allSlides = [];
            manifest.forEach((section, sectionIndex) => {
                section.slides.forEach((slide, slideIndex) => {
                    allSlides.push({
                        ...slide,
                        sectionIndex,
                        sectionTitle: section.title,
                        globalIndex: allSlides.length
                    });
                });
            });
        }

        function buildTOC() {
            const tocContent = document.getElementById('toc-content');
            let html = '';

            manifest.forEach((section, sectionIndex) => {
                html += `
                    <div class="toc-section">
                        <div class="toc-section-title" onclick="toggleSection(${sectionIndex})">
                            <span>${section.title}</span>
                            <span id="arrow-${sectionIndex}">‚ñº</span>
                        </div>
                        <div class="toc-items" id="toc-items-${sectionIndex}">
                `;

                section.slides.forEach((slide, slideIndex) => {
                    const globalIndex = getGlobalIndex(sectionIndex, slideIndex);
                    const cssClass = slide.is_section ? 'toc-item section-title' : 'toc-item';
                    html += `
                        <div class="${cssClass}" data-global="${globalIndex}" onclick="goToSlide(${globalIndex})">
                            ${slide.title}
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            tocContent.innerHTML = html;
        }

        function getGlobalIndex(sectionIndex, slideIndex) {
            let index = 0;
            for (let i = 0; i < sectionIndex; i++) {
                index += manifest[i].slides.length;
            }
            return index + slideIndex;
        }

        function toggleSection(sectionIndex) {
            const items = document.getElementById(`toc-items-${sectionIndex}`);
            const arrow = document.getElementById(`arrow-${sectionIndex}`);
            items.classList.toggle('expanded');
            arrow.textContent = items.classList.contains('expanded') ? '‚ñ≤' : '‚ñº';
        }

        function selectSection(sectionIndex) {
            // „Éò„ÉÉ„ÉÄ„Éº„Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.header-nav button[data-section]').forEach(btn => {
                btn.classList.remove('active');
            });
            const btn = document.querySelector(`.header-nav button[data-section="${sectionIndex}"]`);
            if (btn) btn.classList.add('active');

            // Ë©≤ÂΩì„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÊúÄÂàù„ÅÆ„Çπ„É©„Ç§„Éâ„Å∏
            const globalIndex = getGlobalIndex(sectionIndex, 0);
            goToSlide(globalIndex);

            // TOC„ÇíÂ±ïÈñã
            document.querySelectorAll('.toc-items').forEach((items, idx) => {
                if (idx === sectionIndex) {
                    items.classList.add('expanded');
                    document.getElementById(`arrow-${idx}`).textContent = '‚ñ≤';
                }
            });
        }

        function goToSlide(globalIndex) {
            if (globalIndex < 0 || globalIndex >= allSlides.length) return;

            currentSlide = globalIndex;
            const slide = allSlides[globalIndex];

            // ÁîªÂÉè„ÇíÊõ¥Êñ∞
            const container = document.getElementById('slide-container');
            container.innerHTML = `<img src="${slide.image}" alt="${slide.title}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 9%22><rect fill=%22%23333%22 width=%2216%22 height=%229%22/><text x=%228%22 y=%225%22 fill=%22%23666%22 text-anchor=%22middle%22 font-size=%220.5%22>ÁîªÂÉè„Å™„Åó</text></svg>'">`;

            // ÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            document.getElementById('slide-title').textContent = slide.title;
            document.getElementById('slide-counter').textContent = `${globalIndex + 1} / ${allSlides.length} (${slide.sectionTitle})`;

            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº
            const progress = ((globalIndex + 1) / allSlides.length) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;

            // „Éú„Çø„É≥Áä∂ÊÖã
            document.getElementById('prev-btn').disabled = globalIndex === 0;
            document.getElementById('next-btn').disabled = globalIndex === allSlides.length - 1;

            // TOC„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã
            document.querySelectorAll('.toc-item').forEach(item => {
                item.classList.remove('active');
                if (parseInt(item.dataset.global) === globalIndex) {
                    item.classList.add('active');
                    item.scrollIntoView({ block: 'nearest' });
                }
            });

            // „Çª„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.header-nav button[data-section]').forEach(btn => {
                btn.classList.remove('active');
            });
            const sectionBtn = document.querySelector(`.header-nav button[data-section="${slide.sectionIndex}"]`);
            if (sectionBtn) sectionBtn.classList.add('active');
        }

        function prevSlide() {
            goToSlide(currentSlide - 1);
        }

        function nextSlide() {
            goToSlide(currentSlide + 1);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('hidden');
        }

        // „Ç≠„Éº„Éú„Éº„Éâ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                case 'ArrowUp':
                    prevSlide();
                    break;
                case 'ArrowRight':
                case 'ArrowDown':
                case ' ':
                    e.preventDefault();
                    nextSlide();
                    break;
                case 'Home':
                    goToSlide(0);
                    break;
                case 'End':
                    goToSlide(allSlides.length - 1);
                    break;
            }
        });

        // ÂàùÊúüÂåñ
        loadManifest();
    </script>
</body>
</html>
