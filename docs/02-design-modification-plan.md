# 02-design.md 修正計画

このドキュメントは、`src/02-design.md`（設計編）に対する修正計画をまとめたものです。

## 概要

- **対象者**: Java/Spring Boot経験者 → **Python開発者**に変更
- 要件定義プロセスの説明を大幅に強化
- AIの特性を活かした設計プロセスの詳細化
- 設計書の重要性を「人間でも同じ」という観点で説明
- モダンな開発ツール（uv, bun, Result型など）への言及追加

---

## 修正の方針

### 1. 設計書がなぜ必要かの説明強化

**現状**: トークン効率の観点のみで説明

**修正後**: 人間も同じという観点を追加

```markdown
### 設計書がなぜ必要か - 人間もAIも同じ

**人間でも設計書がなければ大変**
- ソースコードのみから全体を理解するのは大変
- 新規メンバーのオンボーディングに時間がかかる
- 設計意図が分からず、修正時に既存機能を壊すリスク

**AIでも同じ**
- 設計書なし：全コード読解に150Kトークン消費
- 設計書あり：30Kトークンで全体を把握
- 設計書がAIの「外部メモリ」として機能
```

---

### 2. 要件定義プロセスの説明強化

#### 2.1 ユーザーストーリー生成のアプローチ

**現状**: ユーザーストーリーの形式説明のみ

**修正後**: AIを活用したユーザーストーリー生成プロセスを詳細化

```markdown
### AIを活用したユーザーストーリー生成

**基本的なアプローチ**
1. まず基本的なやりたいことをAIに伝える
   - 例：「ToDo管理アプリを作りたい」
2. AIにユーザーストーリーを生成してもらう
3. 生成された候補から選択・取捨選択する

**AIの特性を活かす**
- AIはブレインストーミングが得意
- 人間の言語化能力には限界がある
- むしろたくさん生成してもらって選ぶ方が効率的

**AIの傾向への対処**
- AIは要件を作りすぎる傾向がある
- 優先順位がないと人間の判断が難しい
- → MoSCoW分析で優先順位付け
```

---

#### 2.2 ユーザーストーリーの意義

**追加スライド**:

```markdown
### なぜユーザーストーリー形式を使うか

**開発者にとって**
- 何を実装すべきかが明確
- スコープ縮小時の判断基準として適切な粒度

**顧客にとって**
- 技術用語なしで理解できる
- ビジネス価値が明確

**AIにとって**
- 構造化されていて理解しやすい
- 受入基準への変換が容易

**チームにとって**
- 合意形成の単位として適切
- 認識のズレを防ぐ
- 取捨選択の議論がしやすい
```

---

#### 2.3 MoSCoW分析の強化

**現状**: MoSCoW分析の基本説明のみ

**修正後**: AIを活用したMoSCoW分析の詳細

```markdown
### MoSCoW分析 - AIに優先順位を付けてもらう

**なぜMoSCoW分析か**
- AIは大量のユーザーストーリーを生成する
- 優先順位がないと人間の判断が難しい
- 「MoSCoW分析して」の一言で効率的に分類

**AIへのプロンプトの工夫**
- 「理由も含めて」→ 判断根拠を説明
- 「推奨案を提示して」→ 意思決定を支援
- 「メリット・デメリットを」→ トレードオフを明確化

**良いプロダクトを作るコツ**
- MoSCoW分析に時間をかける
- AIに複数の観点から分析させる
- 最終判断は人間が行う
```

---

#### 2.4 ペルソナを活用した多角的分析

**追加スライド**:

```markdown
### ペルソナを活用した多角的MoSCoW分析

**複数ペルソナによる分析**
- 事前に利用者のペルソナを複数設定
- ペルソナごとにMoSCoW分析を実施
- 異なる価値観からの優先順位付け

**ペルソナ例**
- ビジネスユーザー：効率重視、時間短縮
- 技術者：拡張性重視、API充実
- 初心者：使いやすさ重視、学習コスト低

**効果**
- 異なる価値判断基準での優先順位
- 見落としがちな要件の発見
- ターゲットユーザーの明確化
```

---

### 3. プロトタイプ・モックアップの説明強化

**現状**: Claudeアーティファクト機能の説明のみ

**修正後**: 早期フィードバックの重要性を強調

```markdown
### モックアップで早期フィードバックを得る

**企画段階でプロトタイプを作る**
- Claude WEB版のアーティファクト機能
- Gemini Canvas機能
- 簡単に画面モックアップを作成

**早期フィードバックのメリット**
- ユーザーの反応を早く得られる
- ユーザーストーリーの選択が速くなる
- 手戻りコストの削減

**フィードバックループ**
1. モックアップ作成（10分）
2. ユーザーに見せる
3. フィードバックを反映
4. ユーザーストーリーを確定
```

---

### 4. 設計フェーズの説明強化

#### 4.1 設計成果物の詳細化

**現状**: 画面設計、DBスキーマ、受入基準の説明

**修正後**: より具体的な成果物リストと重要性の説明

```markdown
### 設計フェーズで作成する成果物

**画面関連**
- 画面一覧
- 画面遷移図
- 画面部品一覧（各画面のUI部品）

**データ関連**
- データフロー図
- ER図
- データベース設計（早期に時間をかける）

**API関連**
- OpenAPI仕様書（フロントエンド・バックエンド間の通信仕様）
- アーキテクチャ図
- クラス図（公開インタフェースの仕様）

**なぜOpenAPI仕様書が重要か**
- コンポーネント間の通信仕様が明確になる
- フロントエンドとバックエンドの並行開発が可能
- 後続の開発フェーズの効率が向上
```

---

#### 4.2 Mermaid記法の説明追加

**追加スライド**:

```markdown
### Mermaid記法の活用

**Mermaid記法とは**
- テキストでダイアグラムを記述
- UMLでよく使われる図を簡単に作成
- Markdown と組み合わせて使用

**対応する図の種類**
- シーケンス図
- クラス図
- ER図
- 画面遷移図（stateDiagram）

**メリット**
- 人間：俯瞰して見やすい
- AI：少ないトークンで全体を把握
- Git管理が容易（差分が見やすい）
```

---

#### 4.3 データベース設計の重要性

**追加スライド**:

```markdown
### データベース設計の重要性

**なぜ早期に時間をかけるべきか**
- あとからの手戻りの影響が大きい
- スキーマ変更はデータ移行を伴う
- 関連する全機能に影響

**設計時のポイント**
- 関係者を含めた合意形成
- ER図で視覚化して共有
- 正規化の検討

**AIへの指示**
- 「ER図をMermaid記法で作成して」
- 「第3正規形で設計して」
- 「インデックス設計も含めて」
```

---

### 5. 技術選定とAIへの明示的指定

#### 5.1 人間が明示的に指定すべき事項

**追加スライド**:

```markdown
### 人間が明示的に指定すべき技術選定

**AIから提案されにくいモダンなツール**
- パッケージマネージャ：pip → uv
- ランタイム：node/npm → bun
- フォーマッター：black/flake8 → ruff

**AIから提案されにくい設計パターン**
- エラーハンドリング：例外 → Result型（型安全）
- 依存性注入の方式
- テスト戦略（TDD、Property-based testing）

**人間の役割**
- 最新のベストプラクティスを知っておく
- 明示的に技術スタックを指定
- CLAUDE.mdに記載して共有
```

---

#### 5.2 AIへの質問の仕方

**追加スライド**:

```markdown
### AIに技術的決定事項を質問させる

**CLAUDE.mdに記載する指示**
```markdown
実装前に、以下について不明・あいまいな点があれば質問してください：
- 使用するライブラリ・フレームワーク
- エラーハンドリングの方針
- テスト戦略とカバレッジ目標
```

**AIから提案されないことを補う**
- 「モダンな開発のベストプラクティスは？」と質問
- 普段からアンテナを張り巡らせる
- 技術ブログ、カンファレンス、書籍で情報収集

**Result型の例**
- 従来：例外を投げてtry-catchで処理
- モダン：Result<T, E>型で返り値として処理
- 効果：型レベルでエラー処理を強制
```

---

### 6. 受入条件の作り込み

**現状**: GIVEN-WHEN-THEN形式の説明

**修正後**: 段階的な詳細化プロセスの説明

```markdown
### 受入条件の段階的詳細化

**3段階の詳細化**
1. ユーザーストーリー
   - 「As a ユーザー, I want TODOを作成, So that やるべきことを管理」
2. チェックリスト形式の受入条件
   - ✅ タイトルを入力して作成できる
   - ✅ タイトル空でエラーになる
3. GIVEN-WHEN-THEN形式
   - GIVEN: TODO一覧画面が表示されている
   - WHEN: タイトルに「牛乳を買う」と入力して作成ボタン
   - THEN: 一覧に「牛乳を買う」が表示される

**効果**
- 実装フェーズで確実に実装される
- AIの手抜きを防ぐ
- 最終的な製品のクオリティ向上
```

---

### 7. Java → Python への変更

**全体的な変更**:

| 現状 | 修正後 |
|------|--------|
| Java/Spring Boot | Python/FastAPI |
| JUnit 5 | pytest |
| Maven/Gradle | uv |
| CheckStyle, SpotBugs | ruff, pyright |
| JavaDoc | docstring |
| @Transactional | SQLAlchemy Session |
| JaCoCo | pytest-cov |

**コード例の変更**:

```python
# 現状のJava例
@Test
void testCreate_Success() {
    // GIVEN
    Todo todo = new Todo("牛乳を買う");
    // WHEN
    Todo saved = todoRepository.save(todo);
    // THEN
    assertThat(todoRepository.findAll()).contains(saved);
}

# 修正後のPython例
def test_create_success():
    # GIVEN
    todo = Todo(title="牛乳を買う")
    # WHEN
    saved = todo_repository.save(todo)
    # THEN
    assert saved in todo_repository.find_all()
```

---

### 8. クイズの削除

**削除対象**:
- 「【3択クイズ】STEP 1（要件定義）の理解確認」スライド
- 「【〇×クイズ】設計書の役割の理解確認」スライド

---

## 修正後のスライド構成案

### セクション1: イントロダクション
1. タイトルスライド（Python版に更新）
2. STEP 1-2-3とは
3. **設計書がなぜ必要か - 人間もAIも同じ**（新規）
4. トークン効率の観点

### セクション2: AIツール選択戦略
5. Claude WEB版とClaude Codeの使い分け
6. コンテキスト汚染を防ぐ

### セクション3: 要件定義フェーズ
7. **AIを活用したユーザーストーリー生成**（強化）
8. **なぜユーザーストーリー形式を使うか**（新規）
9. ユーザーストーリーの形式
10. INVEST原則
11. **MoSCoW分析 - AIに優先順位を付けてもらう**（強化）
12. **ペルソナを活用した多角的MoSCoW分析**（新規）
13. 要件定義フェーズの成果物

### セクション4: 設計フェーズ
14. **モックアップで早期フィードバックを得る**（強化）
15. **設計フェーズで作成する成果物**（強化）
16. **Mermaid記法の活用**（新規）
17. 画面設計の3要素
18. **データベース設計の重要性**（新規・強化）
19. データフロー図
20. AIに複数案を提案させる
21. **人間が明示的に指定すべき技術選定**（新規）
22. **AIに技術的決定事項を質問させる**（新規）
23. **受入条件の段階的詳細化**（強化）
24. 受入基準の例（Python版）
25. Definition of Done（Python版）
26. 設計フェーズの成果物まとめ

### セクション5: タスク分解フェーズ
27. 階層的タスク分解
28. GIVEN-WHEN-THEN形式
29. タスク分解の実例（Python版）
30. GitHub Issuesでタスク管理
31. 10分ルール

### セクション6: ハンズオン
32. ハンズオン全体の流れ
33. 各段階の詳細
34. 成果物確認

### セクション7: まとめ
35. STEP 1-2-3の復習
36. コンテキストエンジニアリング
37. 次のステップへ
38. 参考資料

---

## 修正の優先順位

### 高優先度（必須）
1. Java → Python への全面変更
2. AIを活用したユーザーストーリー生成プロセスの説明追加
3. MoSCoW分析の詳細化
4. 設計書の重要性を「人間も同じ」観点で説明
5. クイズの削除

### 中優先度（重要）
6. ペルソナを活用した多角的分析の追加
7. 早期フィードバック（モックアップ）の重要性強化
8. データベース設計の重要性追加
9. Mermaid記法の説明追加
10. 人間が明示的に指定すべき技術選定の追加

### 低優先度（推奨）
11. 受入条件の段階的詳細化の説明
12. OpenAPI仕様書の重要性
13. Result型などモダンな設計パターンへの言及

---

## Marpオーバーフロー対策

### 注意事項

新規追加・修正するスライドは以下に注意：
- 1スライドあたり5〜10項目を目安
- 最大3階層まで
- コードブロックは最小限に

### 分量が多くなりそうなスライドの対処

| スライド | 対処方針 |
|---------|---------|
| AIを活用したユーザーストーリー生成 | 2スライドに分割 |
| MoSCoW分析の詳細 | 2スライドに分割 |
| 設計成果物リスト | 画面/データ/APIで3スライド |
| 技術選定の明示的指定 | 2スライドに分割 |

### 修正後の品質チェック

```bash
# CSS追加（初回）
python scripts/fix-slides.py add-css src/02-design.md

# オーバーフローチェック
node scripts/check-slides.js overflow src/02-design.md

# 問題があれば自動修正
python scripts/fix-slides.py auto-font src/02-design.md

# 再チェック
node scripts/check-slides.js overflow src/02-design.md
```
